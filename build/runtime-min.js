KISSY.add("kg/xtemplate/4.0.5/runtime/util",function(a,b,c,d){function j(){var b,a="";for(b in e)a+=b+"|";return a=a.slice(0,-1),g=new RegExp(a,"g")}var k,e={"&":"&amp;",">":"&gt;","<":"&lt;","`":"&#x60;","/":"&#x2F;",'"':"&quot;","'":"&#x27;"},f=/[&<>"'`]/,g=j(),h=/\\?\{([^{}]+)\}/g,i="undefined"!=typeof global?global:window,l=Object.prototype.toString;d.exports=k={isArray:Array.isArray||function(a){return"[object Array]"===l.call(a)},keys:Object.keys||function(a){var c,b=[];for(c in a)a.hasOwnProperty(c)&&b.push(c);return b},each:function(a,b,c){var d,e,f,g,h,i;if(a)if(g=0,h=a&&a.length,i=void 0===h||"[object Function]"===Object.prototype.toString.call(a),c=c||null,i)for(f=k.keys(a);g<f.length&&(d=f[g],b.call(c,a[d],d,a)!==!1);g++);else for(e=a[0];h>g&&b.call(c,e,g,a)!==!1;e=a[++g]);return a},mix:function(a,b){for(var c in b)a[c]=b[c];return a},globalEval:function(a){i.execScript?i.execScript(a):function(a){i["eval"].call(i,a)}(a)},substitute:function(a,b,c){return"string"==typeof a&&b?a.replace(c||h,function(a,c){return"\\"===a.charAt(0)?a.slice(1):void 0===b[c]?"":b[c]}):a},escapeHtml:function(a){return a=""+a,f.test(a)?(a+"").replace(g,function(a){return e[a]}):a},merge:function(){for(var d,a=0,b=arguments.length,c={};b>a;a++)d=arguments[a],d&&k.mix(c,d);return c}}}),KISSY.add("kg/xtemplate/4.0.5/runtime/commands",["./scope","./util"],function(a,b,c,d){var e=b("./scope"),f=b("./util"),g={range:function(a,b){var g,h,c=b.params,d=c[0],e=c[1],f=c[2];for(f?(d>e&&f>0||e>d&&0>f)&&(f=-f):f=d>e?-1:1,g=[],h=d;e>d?e>h:h>e;h+=f)g.push(h);return g},foreach:function(a,b,c){var i,j,k,l,d=b.params,f=d[0],g=d[2]||"xindex",h=d[1];if(f)for(i=f.length,l=0;i>l;l++)j=new e(f[l],{xcount:i,xindex:l},a),k=j.affix,"xindex"!==g&&(k[g]=l,k.xindex=void 0),h&&(k[h]=f[l]),c=b.fn(j,c);return c},forin:function(a,b,c){var i,j,k,d=b.params,f=d[0],g=d[2]||"xindex",h=d[1];if(f)for(k in f)i=new e(f[k],{xindex:k},a),j=i.affix,"xindex"!==g&&(j[g]=k,j.xindex=void 0),h&&(j[h]=f[k]),c=b.fn(i,c);return c},each:function(a,b,c){var d=b.params,e=d[0];return e?f.isArray(e)?g.foreach(a,b,c):g.forin(a,b,c):c},"with":function(a,b,c){var g,d=b.params,f=d[0];return f&&(g=new e(f,void 0,a),c=b.fn(g,c)),c},"if":function(a,b,c){var f,g,h,i,j,k,l,d=b.params,e=d[0];if(e)f=b.fn,f&&(c=f(a,c));else{if(g=!1,h=b.elseIfs,i=b.inverse,h)for(j=0,k=h.length;k>j;j++)if(l=h[j],g=l.test(a)){c=l.fn(a,c);break}!g&&i&&(c=i(a,c))}return c},set:function(a,b,c){return a.mix(b.hash),c},include:1,parse:1,extend:1,block:function(a,b,c){var h,i,k,j,l,m,d=this,e=d.runtime,f=b.params,g=f[0];if(2===f.length&&(h=f[0],g=f[1]),i=e.blocks=e.blocks||{},j=i[g],l={fn:b.fn,type:h},j){if(j.type)if("append"===j.type)l.next=j,i[g]=l;else if("prepend"===j.type){for(k=j;k&&"prepend"===k.type;)m=k,k=k.next;l.next=k,m.next=l}}else i[g]=l;if(!e.extendTpl)for(k=i[g];k;)k.fn&&(c=k.fn.call(d,a,c)),k=k.next;return c},macro:function(a,b,c){var m,n,o,p,q,r,s,t,d=b.hash,f=b.params,g=f[0],h=f.slice(1),i=this,j=i.runtime,k=j.macros=j.macros||{},l=k[g];if(b.fn)k[g]={paramNames:h,hash:d,fn:b.fn};else if(l){if(m=l.hash||{},n=l.paramNames)for(o=0,p=n.length;p>o;o++)q=n[o],m[q]=h[o];if(d)for(r in d)m[r]=d[r];s=new e(m),s.root=a.root,c=l.fn.call(i,s,c)}else t="can not find macro: "+g,c.error(t);return c}};g["debugger"]=function(){f.globalEval("debugger")},d.exports=g}),KISSY.add("kg/xtemplate/4.0.5/runtime/scope",function(a,b,c,d){function e(a,b,c){this.data=void 0!==a?a:{},c?(this.parent=c,this.root=c.root):(this.parent=void 0,this.root=this),this.affix=b||{},this.ready=!1}e.prototype={isScope:1,constructor:e,setParent:function(a){this.parent=a,this.root=a.root},set:function(a,b){this.affix[a]=b},setData:function(a){this.data=a},getData:function(){return this.data},mix:function(a){var c,b=this.affix;for(c in a)b[c]=a[c]},get:function(a){var c,b=this.data,d=this.affix;return null!=b&&(c=b[a]),void 0!==c?c:d[a]},resolveInternalOuter:function(a){var c,b=a[0],d=this,e=d;if("this"===b)c=d.data;else if("root"===b)e=e.root,c=e.data;else{if(!b)return[e.data];do c=e.get(b);while(void 0===c&&(e=e.parent))}return[void 0,c]},resolveInternal:function(a){var c,d,e,b=this.resolveInternalOuter(a);if(1===b.length)return b[0];if(d=a.length,e=b[1],void 0===e)return void 0;for(c=1;d>c;c++)e=e[a[c]];return e},resolveLooseInternal:function(a){var c,d,e,b=this.resolveInternalOuter(a);if(1===b.length)return b[0];for(d=a.length,e=b[1],c=1;null!=e&&d>c;c++)e=e[a[c]];return e},resolveUp:function(a){return this.parent&&this.parent.resolveInternal(a)},resolveLooseUp:function(a){return this.parent&&this.parent.resolveLooseInternal(a)},resolveOuter:function(a,b){var e,c=this,d=c;if(!b&&1===a.length){if(e=c.get(a[0]),void 0!==e)return[e];b=1}if(b)for(;d&&b--;)d=d.parent;return d?[void 0,d]:[void 0]},resolveLoose:function(a,b){var c=this.resolveOuter(a,b);return 1===c.length?c[0]:c[1].resolveLooseInternal(a)},resolve:function(a,b){var c=this.resolveOuter(a,b);return 1===c.length?c[0]:c[1].resolveInternal(a)}},d.exports=e}),KISSY.add("kg/xtemplate/4.0.5/runtime/linked-buffer",["./util"],function(a,b,c,d){function f(a,b,c){this.list=a,this.init(),this.next=b,this.ready=!1,this.tpl=c}function g(a,b){var c=this;c.config=b,c.head=new f(c,void 0),c.callback=a,this.init()}var e=b("./util");f.prototype={constructor:f,isBuffer:1,init:function(){this.data=""},append:function(a){return this.data+=a,this},write:function(a){if(null!=a){if(a.isBuffer)return a;this.data+=a}return this},writeEscaped:function(a){if(null!=a){if(a.isBuffer)return a;this.data+=e.escapeHtml(a)}return this},insert:function(){var a=this,b=a.list,c=a.tpl,d=new f(b,a.next,c),e=new f(b,d,c);return a.next=e,a.ready=!0,e},async:function(a){var b=this.insert(),c=b.next;return a(b),c},error:function(a){var c,d,e,f,b=this.list.callback;b&&(c=this.tpl,c&&(a instanceof Error||(a=new Error(a)),d=c.name,e=c.pos.line,f="XTemplate error in file: "+d+" at line "+e+": ",a.stack=f+a.stack,a.message=f+a.message,a.xtpl={pos:{line:e},name:d}),this.list.callback=null,b(a,void 0))},end:function(){var a=this;return a.list.callback&&(a.ready=!0,a.list.flush()),a}},g.prototype={constructor:g,init:function(){this.data=""},append:function(a){this.data+=a},end:function(){this.callback(null,this.data),this.callback=null},flush:function(){for(var a=this,b=a.head;b;){if(!b.ready)return a.head=b,void 0;this.data+=b.data,b=b.next}a.end()}},g.Buffer=f,d.exports=g}),KISSY.add("kg/xtemplate/4.0.5/runtime",["./runtime/util","./runtime/commands","./runtime/scope","./runtime/linked-buffer"],function(a,b,c,d){function j(a,b,c,d,e,f,g,h){this.name=a,this.originalName=f||a,this.runtime=b,this.root=c,this.pos={line:1},this.scope=d,this.buffer=e,this.fn=g,this.parent=h}function k(a,b,c){var f,h,d=c[0],e=a&&a[d]||b&&b[d]||g[d];if(1===c.length)return e;if(e)for(f=c.length,h=1;f>h;h++)if(e=e[c[h]],!e)return!1;return e}function l(a,b){var e,f,g,c=a.split("/"),d=b.split("/");for(c.pop(),e=0,f=d.length;f>e;e++)g=d[e],"."===g||(".."===g?c.pop():c.push(g));return c.join("/")}function m(a,b,c,d,e,f){var g,h,i;return f||(i=k(a.runtime.commands,a.root.config.commands,e)),i?i.call(a,b,c,d):i!==!1&&(g=b.resolve(e.slice(0,-1),f),h=g[e[e.length-1]])?h.apply(g,c.params||[]):(d.error("Command Not Found: "+e.join(".")),d)}function o(a,b){var c=this;c.fn=a,c.config=e.merge(o.globalConfig,b),this.subNameResolveCache={}}function p(a,b,c){var d,e,f;return"."!==b.charAt(0)?b:(d=c+"_ks_"+b,e=a.subNameResolveCache,(f=e[d])?f:b=e[d]=l(c,b))}function q(a,b,c,d,e,f){var g=p(a,f,e.name),h=d.insert(),i=h.next;return s(a,g,e.runtime,b,h,f,c,d.tpl),i}function r(a,b,c,d,e){var f=c.insert(),g=f.next,h=new j(e.TPL_NAME,d.runtime,a,b,f,void 0,e,c.tpl);return f.tpl=h,t(h),g}function s(a,b,c,d,e,f,g,h){var i=new j(b,c,a,d,e,f,void 0,h);e.tpl=i,a.config.loader.load(i,function(a,b){"function"==typeof b?(i.fn=b,t(i)):a?e.error(a):(b=b||"",g?e.writeEscaped(b):e.data+=b,e.end())})}function t(a){var c,d,e,f,g,b=a.fn();return b?(c=a.runtime,d=c.extendTpl,d&&(e=d.params[0],!e)?b.error("extend command required a non-empty parameter"):(f=c.extendTplFn,g=c.extendTplBuffer,f?(c.extendTpl=null,c.extendTplBuffer=null,c.extendTplFn=null,r(a.root,a.scope,g,a,f).end()):e&&(c.extendTpl=null,c.extendTplBuffer=null,q(a.root,a.scope,0,g,a,e).end()),b.end())):void 0}var e=b("./runtime/util"),f=b("./runtime/commands"),g={},h=b("./runtime/scope"),i=b("./runtime/linked-buffer"),n={callFn:m,callDataFn:function(a,b){var e,f,c=b[0],d=c;for(e=1;e<b.length;e++){if(f=b[e],!d||null==d[f])return"";c=d,d=d[f]}return d.apply(c,a||[])},callCommand:function(a,b,c,d,e){return m(a,b,c,d,e)}};e.mix(o,{config:function(a,b){var c=this.globalConfig=this.globalConfig||{};return arguments.length?(void 0!==b?c[a]=b:e.mix(c,a),void 0):c},nativeCommands:f,utils:n,util:e,addCommand:function(a,b){g[a]=b},removeCommand:function(a){delete g[a]}}),o.prototype={constructor:o,Scope:h,nativeCommands:f,utils:n,removeCommand:function(a){var b=this.config;b.commands&&delete b.commands[a]},addCommand:function(a,b){var c=this.config;c.commands=c.commands||{},c.commands[a]=b},include:function(a,b,c,d){var e=b.params,f=a,g=b.hash,i=b&&b.escape;return g&&(f=new h(g,void 0,a)),e[0]?c=q(this,f,i,c,d,e[0]):c.error("include command required a non-empty parameter")},includeModule:function(a,b,c,d){var e=b.params,f=a,g=b.hash;return g&&(f=new h(g,void 0,a)),e[0]?c=r(this,f,c,d,e[0]):c.error("include command required a non-empty parameter")},render:function(a,b,c){var i,k,l,m,d="",e=this,f=e.fn,g=e.config;return"function"==typeof b&&(c=b,b=null),b=b||{},c=c||function(a,b){if(a)throw a instanceof Error||(a=new Error(a)),a;d=b},i=e.config.name,!i&&f&&f.TPL_NAME&&(i=f.TPL_NAME),k=a instanceof h?a:new h(a),l=new o.LinkedBuffer(c,g).head,m=new j(i,{commands:b.commands},e,k,l,i,f),l.tpl=m,f?(t(m),d):(g.loader.load(m,function(a,b){b?(m.fn=e.fn=b,t(m)):a&&l.error(a)}),d)}},o.Scope=h,o.LinkedBuffer=i,d.exports=o});